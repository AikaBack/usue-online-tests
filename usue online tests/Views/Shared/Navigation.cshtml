@inject GetUserByCookie User
@inject DataContext context
@using System.Text
@using usue_online_tests.Data

<script>
  
        var r = $.post("/availabletests/count",
            {},
            function (data, status) {
                document.getElementsByClassName("navigation-item")[0].innerText += " (" + data + ")";
            });

</script>

<nav class="max-w-screen-lg mx-auto navbar p-0">
    <a class="text-xl flex-1" href="/">Аудиторные тесты</a>
    <ul class="menu menu-horizontal p-0">
        @{
            var user = User.GetUser();
            if (user?.Role is Roles.Admin or Roles.Teacher)
            {
                <li><a class="hidden" href="/testpresets">Шаблоны тестов</a></li>
                <li><a class="hidden" href="/studentlist">Списки студентов</a></li>
            }

            if (user?.Role is Roles.User)
            {
                <li><a class="hidden" href="/availabletests">Тесты для прохождения</a></li>
            }


            if (Context.User.Identity is { IsAuthenticated: true })
            {
                // https://mui.com/components/avatars/#letter-avatars
                var hash = 0;
                var username = user?.Name;

                for (var i = 0; i < username?.Length; i += 1)
                {
                    hash = Encoding.ASCII.GetBytes(username)[i] + ((hash << 5) - hash);
                }

                var profileColor = "#";

                for (var i = 0; i < 3; i += 1)
                {
                    var value = (hash >> (i * 8)) & 0xff;
                    profileColor += $"{value.ToString("X2")}";
                }

                <li><a class="hidden" href="/tests/view">Доступные тесты</a></li>
                <div class="dropdown dropdown-end">
                    <label tabindex="0" class="btn btn-ghost btn-circle">
                        <div class="w-10 h-10 rounded-full text-white cursor-pointer flex justify-center items-center" style="background: @profileColor">
                            @char.ToUpper(username[0])
                        </div>
                    </label>
                    <ul tabindex="0" class="mt-3 p-2 shadow menu menu-compact dropdown-content bg-base-100 rounded-box w-52">
                        <li><a href="/profile">Профиль</a></li>
                        <li><a href="/testpresets">Шаблоны тестов</a></li>
                        <li><a href="/studentlist">Списки студентов</a></li>
                        <li><a href="/availabletests">Тесты для прохождения</a></li>
                        <li><a href="/tests/view">Доступные тесты</a></li>
                        <li><a href="/login/loginout">Выход</a></li>
                    </ul>
                </div>

                var mobileMenuColor = user is { IsDark: true } ? "white" : "black";

                <svg class="hidden" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                     fill="@mobileMenuColor">
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
                <div class="navigation-mobile-menu hidden">
                    @if (user?.Role is Roles.Admin or Roles.Teacher)
                    {
                        <a class="navigation-profile-menu-item" href="/testpresets">Шаблоны тестов</a>
                        <a class="navigation-profile-menu-item" href="/studentlist">Списки студентов</a>
                    }
                    @if (user?.Role is Roles.User)
                    {
                        <a class="navigation-item" href="/availabletests">Тесты для прохождения</a>
                    }
                    <a class="navigation-profile-menu-item" href="/tests/view">Доступные тесты</a>
                    <a class="navigation-profile-menu-item" href="/profile">Профиль</a>
                    <p class="navigation-profile-menu-item mobile-theme-switcher">Изменить тему</p>
                    <a class="navigation-profile-menu-item" href="/login/loginout">Выход</a>
                </div>
            }
        }
    </div>
</nav>